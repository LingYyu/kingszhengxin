<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="手机贷征信平台,星辰后台">
    <title>kings征信-新建用户</title>
    <!-- Bootstrap core CSS -->
    <link href="../dist/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <!-- Custom styles for this template -->
    <!-- <link href="../dist/css/style.css" rel="stylesheet" type="text/css" /> -->
    <!-- Latest compiled and minified CSS -->
    <link href="../dist/css/web_style.css" rel="stylesheet" type="text/css">
    <link href="../dist/css/bootstrapValidator.css" rel="stylesheet" />
    <link href="../dist/css/buttons.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="../dist/js/angular-1.4.6.min.js"></script>
</head>

<body ng-app="myApp" ng-controller="createuserCtrl">
    <nav class="navbar navbar-fixed-top navbar-credit">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="logo_a" href="#">Project name</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav nav_ul">
                    <li class="active">
                        <a href="creatUser.html">新建用户</a>
                    </li>
                    <li>
                        <a href="user.html">用户列表</a>
                    </li>
                    <li>
                        <a href="history.html">查询历史</a>
                    </li>
                    <li>
                        <a href="account.html">账户信息</a>
                    </li>
                </ul>
                <div class="sigin_out"><a href="singin.html">退出</a></div>
            </div>
        </div>
    </nav>
    <div class="container container-fluid">
        <div class="row">
            <ol class="breadcrumb_web">
                <li class="active">核验身份<i class="glyphicon glyphicon-menu-right"></i></li>
                <li>
                    <a href="#">录入基本信息<i class="glyphicon glyphicon-menu-right"></i></a>
                </li>
                <li>
                    <a href="#">选择查询模块<i class="glyphicon glyphicon-menu-right"></i></a>
                </li>
                <li>
                    <a href="#">上传补充资料<i class="glyphicon glyphicon-menu-right"></i></a>
                </li>
                <li>
                    <a href="#">生成报告</a>
                </li>
            </ol>
        </div>
        <div class="blank_20"></div>
        <div class="row">
            <form class="form-horizontal" role="form" id="defaultForm">
                <div class="col-md-4 col-sm-4 col-xs-4">
                    <div class="form-group form_infor">
                        <label class="col-md-4">姓名：</label>
                        <div class="col-md-8">
                            <input ng-model="username" type="text" class="form-control form-control_red" placeholder="请输入姓名" maxlength="30" onkeyup="noEmpty(this)" name="userName" id="userName" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-sm-4 col-xs-4">
                    <div class="form-group form_infor">
                        <label class="col-md-4">身份证号：</label>
                        <div class="col-md-8">
                            <input ng-model="IDcard" type="text" class="form-control form-control_red" placeholder="请输入身份证号" onchange="isIdentityCode(this)" onkeyup="isIdentityCode(this)" maxlength="18" name="identityCode" id="identityCode" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-sm-4 col-xs-4">
                    <div class="form-group form_infor">
                        <label class="col-md-4">手机号：</label>
                        <div class="col-md-8">
                            <input ng-model="telNumber" type="text" class="form-control form-control_red" placeholder="请输入手机号" maxlength="11" onkeyup="isTel(this)" name="telNum" id="telNum" />
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <br>
        <br>
        <div class="row">
            <div class="col-sm-4"></div>
            <div class="col-md-4">
                <button type="button" class="btn btn-lg btn-block btn-credit" onclick="checkAll()" ng-disabled="error || incomplete">核验</button>
            </div>
            <div class="col-sm-4"></div>
        </div>
    </div>
    </div>
    <!-- 模态框（Modal） -->
    <div class="modal fade bs-example-modal-sm" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog modal-sm" role="document" style="width: 300px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">校验失败</h4>
                </div>
                <div class="modal-body" style="text-align: center; font-size: 18px;">
                    <div class="blank_20"></div>
                    <p id="myModalContent">身份证与姓名不一致</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-credit btn-block" data-dismiss="modal">确定</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    
     <div class="modal fade bs-example-modal-sm" style="z-index: 9999;" id="siginWei" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-sm" role="document" style="width: 300px;">
				<div class="modal-content">
					
					<div class="modal-body" style="text-align: center; font-size: 18px;">
						<div class="blank_20"></div>
						<p id="myModalContent">
							请先登录
						</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-credit btn-block" data-dismiss="modal" id="modal_btn" onclick="toSigin()">确定</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
	</div>
    <script src="../dist/js/jquery.min.1.11.2.js" type="text/javascript"></script>
    <script src="../dist/js/bootstrap.js" type="text/javascript"></script>
    <script src="../dist/js/jquery-ui.min.js" type="text/javascript"></script>
    <script src="../dist/js/bootstrapValidator.js" type="text/javascript"></script>
    <script type="text/javascript" src="../dist/js/common.js" ></script>
    <script type="text/javascript" src="../dist/js/login/login.js"></script>
    <script type="text/javascript" src="../dist/js/login/createUser.js"></script>
    <script>
    /**
     * 判断当前对象是否为空
     * @method isEmpty
     * @param {Object} obj
     * @return {Boolean} empty 当为 null,undefined,"" 将返回true
     */
    function isEmpty(obj) {
        return (obj == null || typeof obj == "undefined" || obj.length == 0)
    }
    /**
     * 判断当前对象是否非空
     * @method isNotEmpty
     * @param {Object} obj
     * @return {Boolean}
     */
    function isNotEmpty(obj) {
        return !isEmpty(obj);
    }
    String.prototype.trim = function() {
        return this.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
    }

    function checkTel(tel) {
        //var isPhone = /^([0-9]{3,4}-)?[0-9]{7,8}$/;
        //var isMob = /^((\+?86)|(\(\+86\)))?(13[0123456789][0-9]{8}|15[012356789][0-9]{8}|18[02356789][0-9]{8}|147[0-9]{8}|1349[0-9]{7})$/;
        //var value = tel.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
        var isMob = /^(13[0-9]{9})|(15[0-9]{9})|(18[0-9]{9}$)/;
        if (isMob.test(tel)) {
            return true;
        } else {
            return false;
        }
    }

    function noEmpty(event) {
        if (isNotEmpty($(event).val())) {
            $(event).removeClass('form-control_red');
        } else {
            $(event).addClass('form-control_red');
        }
    }

    function isTel(event) {
        if (checkTel($(event).val())) {
            $(event).removeClass('form-control_red');
        } else {
            $(event).addClass('form-control_red');
        }
    }

    function isIdentityCode(event) {
        //alert(event.value);
        if (IdentityCodeValid($(event).val())) {
            $(event).removeClass('form-control_red');
        } else {
            $(event).addClass('form-control_red');
        }
    }
    //身份证号合法性验证 
    //支持15位和18位身份证号
    //支持地址编码、出生日期、校验位验证
    function IdentityCodeValid(code) {
        var city = {
            11: "北京",
            12: "天津",
            13: "河北",
            14: "山西",
            15: "内蒙古",
            21: "辽宁",
            22: "吉林",
            23: "黑龙江 ",
            31: "上海",
            32: "江苏",
            33: "浙江",
            34: "安徽",
            35: "福建",
            36: "江西",
            37: "山东",
            41: "河南",
            42: "湖北 ",
            43: "湖南",
            44: "广东",
            45: "广西",
            46: "海南",
            50: "重庆",
            51: "四川",
            52: "贵州",
            53: "云南",
            54: "西藏 ",
            61: "陕西",
            62: "甘肃",
            63: "青海",
            64: "宁夏",
            65: "新疆",
            71: "台湾",
            81: "香港",
            82: "澳门",
            91: "国外 "
        };
        var tip = "";
        var pass = true;

        if (!code || !/^[1-9][0-9]{5}(19[0-9]{2}|200[0-9]|2010)(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])[0-9]{3}[0-9xX]$/i.test(code)) {
            tip = "身份证号格式错误";
            pass = false;
        } else if (!city[code.substr(0, 2)]) {
            tip = "地址编码错误";
            pass = false;
        } else {
            //18位身份证需要验证最后一位校验位
            if (code.length == 18) {
                code = code.split('');
                //∑(ai×Wi)(mod 11)
                //加权因子
                var factor = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
                //校验位
                var parity = [1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2];
                var sum = 0;
                var ai = 0;
                var wi = 0;
                for (var i = 0; i < 17; i++) {
                    ai = code[i];
                    wi = factor[i];
                    sum += ai * wi;
                }
                var last = parity[sum % 11];
                if (parity[sum % 11] != code[17]) {
                    tip = "校验位错误";
                    pass = false;
                }
            }
        }
        //if(!pass) alert(tip);
        return pass;
    }

    //校验全部
    function checkAll() {
        var userName = $("#userName").val();
        var identityCode = $("#identityCode").val();
        var telNum = $("#telNum").val();
        $.ajax({
            type: "post",
            url: "http://localhost:9999/isInUserReport",
            dataType: "jsonp",
            jsonp: "checkAll",
            jsonpCallback: "success_jsonpCallback",
            data: {
                "name": userName,
                "id_card": identityCode,
                "telNum": telNum,
            },
            success: function(data) {
                if (data == "notExist") {
                    showModal("校验失败", "身份证与姓名不一致");
                } else if (data == "notNewUser") {
                    showModal("非新用户", "姓名和身份证号已存在，请在“用户列表”中查询！")
                } else {
                    window.location.href = "entryInfo.html";
                }
            },
            error: function(data) {}
        });
        /*	if(!isNotEmpty($('#userName').val()) || !IdentityCodeValid($('#identityCode').val())){
        		$("#myModal").modal("show");
        	}
        	else if(isNotEmpty($('#userName').val()) && checkTel($('#telNum').val()) && IdentityCodeValid($('#identityCode').val())){
        		window.location.href = "entryInfo.html";
        	}*/
    }
    /*修改弹出层内容*/
    function showModal(title, content) {
        $("#myModalLabel").html(title);
        $("#myModalContent").html(content);
        $("#myModal").modal("show");
    }
    </script>
</body>

</html>
