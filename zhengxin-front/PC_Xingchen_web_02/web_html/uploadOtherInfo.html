<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="手机贷征信平台,星辰后台">
    <title>kings征信-上传补充资料</title>
    <!-- Bootstrap core CSS -->
    <link href="../dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Latest compiled and minified CSS -->
    <link href="../dist/css/web_style.css" rel="stylesheet" type="text/css">
    <link href="../dist/css/bootstrapValidator.css" rel="stylesheet" />
    <link href="../dist/css/buttons.css" rel="stylesheet" type="text/css">
    <link href="../dist/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
</head>

<body>
    <nav class="navbar navbar-fixed-top navbar-credit">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="logo_a" href="#">Project name</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav nav_ul">
                    <li class="active">
                        <a href="creatUser.html">新建用户</a>
                    </li>
                    <li>
                        <a href="user.html">用户列表</a>
                    </li>
                    <li>
                        <a href="history.html">查询历史</a>
                    </li>
                    <li>
                        <a href="account.html">账户信息</a>
                    </li>
                </ul>
                <div class="sigin_out"><a href="singin.html">退出</a></div>
            </div>
        </div>
    </nav>
    <div class="container container-fluid">
        <div class="row">
            <ol class="breadcrumb_web">
                <li class="active">核验身份<i class="glyphicon glyphicon-menu-right"></i></li>
                <li class="active">录入基本信息<i class="glyphicon glyphicon-menu-right"></i></li>
                <li class="active">选择查询模块<i class="glyphicon glyphicon-menu-right"></i></li>
                <li class="active">上传补充资料<i class="glyphicon glyphicon-menu-right"></i></li>
                <li>
                    <a href="#">生成报告</a>
                </li>
            </ol>
        </div>
        <form class="form-horizontal" role="form" id="entryInfoForm">
            <div class="row">
                <div class="form-group form_infor">
                    <label class="col-sm-offset-3 col-sm-2">公司名称：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" value="" id="companyName" name="companyName" placeholder="公司名称">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-group form_infor">
                    <label class="col-sm-offset-3 col-sm-2">职位：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" placeholder="职位" id="zhiwei" name="zhiwei">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-group form_infor">
                    <label class="col-sm-offset-3 col-sm-2">家庭地址：</label>
                    <div class="col-sm-4">
                        <input type="text" id="homeAddress" name="homeAddress" class="form-control" placeholder="上海市徐汇区虹梅路2666弄30号楼803">
                    </div>
                </div>
            </div>
        </form>
        <div class="row">
            <div class="col-sm-10 col-md-offset-1 col-sm-offset-1">
                <div class="col-sm-4 col-md-4 img_div">
                    <label>住址证明材料</label>
                    <img src="../dist/images/images_001.jpg" class="mg-rounded-disc center-block" alt="...">
                    <a href="##">样例</a>
                    <input type="file" id="P1" class="hidden" accept="image/jpeg,image/png" onchange="fileChange(this)" />
                </div>
                <div class="col-sm-4 col-md-4 img_div">
                    <label>工作证明材料</label>
                    <img src="../dist/images/images_001.jpg" class="mg-rounded-disc center-block" alt="...">
                    <a href="##">样例</a>
                    <input type="file" id="P2" class="hidden" accept="image/jpeg,image/png" onchange="fileChange(this)" />
                </div>
                <div class="col-sm-4 col-md-4 img_div">
                    <label>收入证明材料</label>
                    <img src="../dist/images/images_001.jpg" class="mg-rounded-disc center-block" alt="...">
                    <a href="##">样例</a>
                    <input type="file" id="P3" class="hidden" accept="image/jpeg,image/png" onchange="fileChange(this)" />
                </div>
            </div>
            <div class="row">
                <div class="img_div">
                    <label>每个附件不超过10M,支持jpg、png格式</label>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-offset-3 col-sm-6">
                    <div class="col-sm-6">
                        <a href="##" onclick="tiaoguo()" style="text-decoration:none;">
                            <button type="button" class="btn btn-lg btn-block btn-credit_text">跳过</button>
                        </a>
                    </div>
                    <div class="col-sm-6">
                        <a href="##" onclick="checkAll()">
                            <button type="button" class="col-sm-3 btn btn-lg btn-block btn-credit">下一步</button>
                        </a>
                    </div>
                </div>
            </div>
            <!-- 模态框（Modal） -->
            <div class="modal fade bs-example-modal-sm" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
                <div class="modal-dialog modal-sm" role="document" style="width: 636px;">
                    <div class="modal-content">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute;z-index: 1001;right: 20px;"><span aria-hidden="true">&times;</span></button>
                        <img src="../dist/images/u202.png" />
                    </div>
                </div>
                <!-- /.modal-dialog -->
            </div>
            <div class="modal fade bs-example-modal-sm" id="checkimg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
                <div class="modal-dialog modal-sm" role="document" style="width: 300px;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title" id="myModalLabel">上传失败</h4>
                        </div>
                        <div class="modal-body" style="text-align: center; font-size: 18px;">
                            <div class="blank_20"></div>
                            <p id="myModalContent"></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-credit btn-block" data-dismiss="modal" id="modal_btn">确定</button>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
            <script src="../dist/js/jquery-2.1.1.js" type="text/javascript"></script>
            <script src="../dist/js/bootstrap.js" type="text/javascript"></script>
            <script src="../dist/js/bootstrapValidator.js" type="text/javascript"></script>
            <script type="text/javascript" src="../dist/js/login/ajaxfileupload.js"></script>
            <script type="text/javascript" src="../dist/js/plugins/ajaxfileupload.js"></script>
            <script>
            function tiaoguo() {

                $.ajax({
                    url: "http://localhost:9999/tiaoguo",
                    dataType: "jsonp",
                    jsonp: "tiaoguo",
                    jsonpCallback: "success_jsonpCallback",
                    data: {

                    },
                    success: function(data) {

                        window.location.href = "generateReport.html";
                    },
                    error: function(data) {
                        window.location.href = "generateReport.html";
                    }
                });
            }
            //校验全部
            function checkAll() {
                tiaoguo();
                var companyName = $("#companyName").val();
                var zhiwei = $("#zhiwei").val();
                var homeAddress = $("#homeAddress").val();
                console.log($("#P1").val());
                console.log($("#P2").val());
                console.log($("#P3").val());

                $.ajaxFileUpload({
                    url: "http://localhost:9999/uploadAdditionalInformation",
                    secureuri: false,
                    fileElementId: ['P1', 'P2', 'P3'],
                    dataType: "jsonp",
                    jsonp: "checkAll",
                    jsonpCallback: "success_jsonpCallback",
                    data: {
                        "companyName": companyName,
                        "zhiwei": zhiwei,
                        "homeAddress": homeAddress,
                    },
                    success: function(data) {},
                    error: function(data) {
                        window.location.href = "generateReport.html";
                        console.log(data);
                    }
                });
            }

            function getObjectURL(file) {
                var url = null;
                if (window.createObjectURL != undefined) { // basic
                    url = window.createObjectURL(file);
                } else if (window.URL != undefined) { // mozilla(firefox)
                    url = window.URL.createObjectURL(file);
                } else if (window.webkitURL != undefined) { // webkit or chrome
                    url = window.webkitURL.createObjectURL(file);
                }
                return url;
            }
            $(function() {
                $("input[type='file']").on("change", function() {
                    var objUrl = getObjectURL(this.files[0]); //获取图片的路径，该路径不是图片在本地的路径
                    if (objUrl) {
                        $(this).siblings("img").attr("src", objUrl); //将图片路径存入src中，显示出图片
                    }
                });
                $(".mg-rounded-disc").on("click", function() {
                    $(this).siblings("input[type='file']").click();
                });
            });
            // 上传图片
            var isIE = /msie/i.test(navigator.userAgent) && !window.opera;

            function fileChange(target, id) {
                var fileSize = 0;
                var filetypes = [".jpg", ".png", "PNG", ".JPG"];
                var filepath = target.value;
                var filemaxsize = 1024 * 10; //10M
                if (filepath) {
                    var isnext = false;
                    var fileend = filepath.substring(filepath.indexOf("."));
                    if (filetypes && filetypes.length > 0) {
                        for (var i = 0; i < filetypes.length; i++) {
                            if (filetypes[i] == fileend) {
                                isnext = true;
                                break;
                            }
                        }
                    }
                    if (!isnext) {
                        showModal("不接受此文件类型！", target.id);
                        //						alert("不接受此文件类型！");
                        target.value = "";
                        return false;
                    }
                } else {
                    return false;
                }
                if (isIE && !target.files) {
                    var filePath = target.value;
                    var fileSystem = new ActiveXObject("Scripting.FileSystemObject");
                    if (!fileSystem.FileExists(filePath)) {
                        showModal("附件不存在，请重新输入！", target.id);
                        return false;
                    }
                    var file = fileSystem.GetFile(filePath);
                    fileSize = file.Size;
                } else {
                    fileSize = target.files[0].size;
                }

                var size = fileSize / 1024;
                if (size > filemaxsize) {
                    showModal("附件大小不能大于" + filemaxsize / 1024 + "M！", target.id);
                    //					alert("附件大小不能大于" + filemaxsize / 1024 + "M！");
                    target.value = "";
                    return false;
                }
                if (size <= 0) {
                    showModal("附件大小不能为0M！", target.id);
                    //					alert("附件大小不能为0M！");
                    target.value = "";
                    return false;
                }
            }
            /*修改弹出层内容*/
            function showModal(content, id) {
                $("#myModalContent").html(content);
                $("#modal_btn").attr("onClick", "showerror('" + id + "')");
                $("#checkimg").modal("show");
            }
            /*格式错误再次弹出上传文件窗口*/
            function showerror(id) {
                $("#" + id).click();
            }
            /* 创建用户页面弹出对话框移动 */
            $(function() {
                $(".modal-content").draggable({
                    cursor: "move",
                    //		handle: '.modal-header'
                });
            });
            </script>
</body>

</html>
